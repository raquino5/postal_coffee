<!-- Breadcrumbs: Home › Category › Product -->
<% content_for :breadcrumbs do %>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <%= link_to "Home", root_path %>
      </li>
      <li class="breadcrumb-item">
        <%= link_to @product.category.name, category_path(@product.category) %>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <%= @product.name %>
      </li>
    </ol>
  </nav>
<% end %>

<h1 class="mb-3"><%= @product.name %></h1>

<div class="mb-3 d-flex gap-2">
  <%= link_to "Back to Products",
        products_path,
        class: "btn btn-secondary btn-sm" %>

  <%= link_to "View Cart",
        cart_path,
        class: "btn btn-secondary btn-sm" %>
</div>

<div class="row g-4">
  <!-- Left: Image -->
  <div class="col-md-5">
    <div class="card">
      <% if @product.image.attached? %>
        <div class="product-image mb-2">
          <%= image_tag url_for(@product.image), class: "img-fluid" %>
        </div>
      <% else %>
        <p class="text-muted mb-0">No image available.</p>
      <% end %>
    </div>
  </div>

  <!-- Right: Details + Add to cart -->
  <div class="col-md-7">
    <div class="card mb-3">
      <p class="product-meta mb-1">
        <strong>Category:</strong>
        <%= link_to @product.category.name, category_path(@product.category) %>
      </p>

      <p class="product-price mb-2">
        <strong>Price:</strong>
        $<%= "%.2f" % @product.price %>
      </p>

      <div class="product-badges mb-2">
        <% if @product.on_sale? %>
          <span class="badge badge-sale">On Sale</span>
        <% end %>
        <% if @product.created_at >= 3.days.ago %>
          <span class="badge badge-new">New</span>
        <% elsif @product.updated_at >= 3.days.ago && @product.created_at < 3.days.ago %>
          <span class="badge badge-updated">Recently updated</span>
        <% end %>
      </div>
    </div>

    <div class="card">
      <h3 class="mb-3">Add to Cart</h3>

      <%= form_with url: add_item_cart_path,
                    method: :post,
                    local: true do %>
        <%= hidden_field_tag :product_id, @product.id %>

        <div class="form-group mb-3">
          <%= label_tag :quantity, "Quantity", class: "form-label" %>
          <%= number_field_tag :quantity,
                               1,
                               min: 1,
                               class: "form-control",
                               style: "max-width: 120px;" %>
        </div>

        <%= submit_tag "Add to Cart",
              class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>

<div class="card mt-4">
  <h3>Description</h3>
  <p><%= @product.description %></p>
</div>
